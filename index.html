<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LocalScript Dojo</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
  background:#0f1220;
  color:#eaeaf0;
}
header{
  padding:12px;
  background:#171a2e;
  font-weight:700;
}
#editor{
  height:55vh;
}
#panel{
  padding:10px;
  background:#171a2e;
}
button{
  padding:6px 10px;
  border-radius:6px;
  border:none;
  background:#4c6ef5;
  color:white;
}
#log{
  font-size:13px;
  opacity:.9;
  white-space:pre-wrap;
}
</style>

<!-- Monaco -->
<script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>
</head>

<body>
<header>LocalScript Dojo（完成版）</header>

<div id="editor"></div>

<div id="panel">
  <button id="insertBtn">おすすめを挿入</button>
  <div id="log">ready.</div>
</div>

<script>
// ======================
// エラー可視化（保険）
// ======================
window.onerror = function(msg, src, line, col){
  document.getElementById("log").textContent =
    "JS ERROR:\n" + msg + "\n" + line + ":" + col;
};

// ======================
// LocalScript 辞書
// ======================
const LS_DB = [
  {
    key:"local.basic",
    desc:"local変数の基本",
    code:`local x = 10
print(x)`
  },
  {
    key:"service.get",
    desc:"Service取得",
    code:`local Players = game:GetService("Players")
local player = Players.LocalPlayer`
  },
  {
    key:"ui.screenGui",
    desc:"ScreenGui作成",
    code:`local Players = game:GetService("Players")
local player = Players.LocalPlayer

local gui = Instance.new("ScreenGui")
gui.Parent = player:WaitForChild("PlayerGui")`
  },
  {
    key:"input.tap",
    desc:"タップ検知",
    code:`local UIS = game:GetService("UserInputService")

UIS.InputBegan:Connect(function(input,gp)
  if gp then return end
  if input.UserInputType == Enum.UserInputType.Touch then
    print("tap")
  end
end)`
  }
];

// ======================
// Monaco 起動
// ======================
require.config({ paths:{ vs:"https://unpkg.com/monaco-editor@0.45.0/min/vs" }});
require(["vs/editor/editor.main"], function(){

  // Lua登録
  monaco.languages.register({ id:"lua" });

  const editor = monaco.editor.create(
    document.getElementById("editor"),
    {
      value:`-- ここにLuaを書く
local`,
      language:"lua",
      theme:"vs-dark",
      quickSuggestions:true,
      tabCompletion:"on"
    }
  );

  // 補完（LocalScript辞書）
  monaco.languages.registerCompletionItemProvider("lua",{
    provideCompletionItems(){
      return {
        suggestions: LS_DB.map(it=>({
          label: it.key,
          kind: monaco.languages.CompletionItemKind.Snippet,
          insertText: it.code,
          documentation: it.desc,
          insertTextRules:
            monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet
        }))
      };
    }
  });

  // 挿入ボタン（全文置換）
  document.getElementById("insertBtn").onclick = ()=>{
    const m = editor.getModel();
    m.setValue(LS_DB[0].code);
    editor.setPosition({ lineNumber:2, column:1 });
    editor.focus();
    document.getElementById("log").textContent =
      "挿入完了：" + LS_DB[0].key;
  };

  document.getElementById("log").textContent = "Monaco ready.";
});
</script>
</body>
</html>